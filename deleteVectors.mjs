import { Pinecone } from "@pinecone-database/pinecone";
import dotenv from 'dotenv';

dotenv.config();

const pinecone_api_key = process.env.PINECONE_PROD_API_KEY;
const vectorIndexName = 'addresses';
const namespace = 'address_v8_prod_adrc';

// Function to initialize Pinecone
async function initializePinecone() {
    const pinecone = new Pinecone({ apiKey: pinecone_api_key });
    const index = pinecone.index(vectorIndexName);
    console.log("Pinecone client and index initialized");
    return index;
}

async function deleteCustomerVectors(customerNumbers) {
    if (!Array.isArray(customerNumbers)) {
        throw new Error('Input must be an array of customer numbers');
    }

    try {
        const index = await initializePinecone();
        const ns = index.namespace(namespace);

        console.log(`Finding vectors for customers: ${customerNumbers.join(', ')}`);

        // Create a dummy vector for querying (required by Pinecone)
        const dummyVector = new Array(1536).fill(0);

        // Get vector IDs for each customer number
        const vectorsToDelete = [];
        
        for (const customer of customerNumbers) {
            const response = await ns.query({
                topK: 10000, // Maximum allowed by Pinecone
                vector: dummyVector,
                filter: {
                    customer: { $eq: parseInt(customer) }
                },
                includeMetadata: false,
                includeValues: false
            });

            if (response.matches && response.matches.length > 0) {
                const ids = response.matches.map(match => match.id);
                vectorsToDelete.push(...ids);
            }
        }

        if (vectorsToDelete.length === 0) {
            console.log('No vectors found to delete');
            return;
        }

        console.log(`Found ${vectorsToDelete.length} vectors to delete`);

        // Delete vectors in batches
        const deleteBatchSize = 1000; // Pinecone's limit for delete operations
        for (let i = 0; i < vectorsToDelete.length; i += deleteBatchSize) {
            const batch = vectorsToDelete.slice(i, i + deleteBatchSize);
            await ns.deleteMany(batch);
            console.log(`Deleted batch ${Math.floor(i / deleteBatchSize) + 1} of ${Math.ceil(vectorsToDelete.length / deleteBatchSize)}`);
        }

        console.log('Deletion completed successfully');
    } catch (error) {
        console.error('Error deleting vectors:', error);
        throw error;
    }
}

// Example usage:
// const customersToDelete = [
//     "1000260",
//     "1000587",
//     "1000603",
//     "1000638",
//     "1000780",
//     "1000916",
//     "1001098",
//     "1001185",
//     "1001389",
//     "1001463",
//     "1001998",
//     "1002332",
//     "1002428",
//     "1002518",
//     "1002772",
//     "1002799",
//     "1002858",
//     "1002914",
//     "1003035",
//     "1004315",
//     "1004439",
//     "1004493",
//     "1004546",
//     "1004551",
//     "1004653",
//     "1004666",
//     "1004700",
//     "1004787",
//     "1004872",
//     "1004881",
//     "1004934",
//     "1004936",
//     "1004956",
//     "1004997",
//     "1005033",
//     "1005147",
//     "1005169",
//     "1005294",
//     "1005315",
//     "1005318",
//     "1005324",
//     "1005436",
//     "1005442",
//     "1005472",
//     "1005487",
//     "1005586",
//     "1005702",
//     "1005714",
//     "1005761",
//     "1005829",
//     "1005868",
//     "1005877",
//     "1005991",
//     "1006013",
//     "1006054",
//     "1006055",
//     "1006096",
//     "1006119",
//     "1006129",
//     "1006131",
//     "1006143",
//     "1006146",
//     "1006286",
//     "1006342",
//     "1006412",
//     "1006429",
//     "1006433",
//     "1006483",
//     "1006502",
//     "1006520",
//     "1006611",
//     "1006696",
//     "1006730",
//     "1006765",
//     "1006766",
//     "1006804",
//     "1006842",
//     "1006883",
//     "1006972",
//     "1006976",
//     "1007007",
//     "1007066",
//     "1007069",
//     "1007073",
//     "1007077",
//     "1007084",
//     "1007100",
//     "1007158",
//     "1007248",
//     "1007277",
//     "1007315",
//     "1007408",
//     "1007467",
//     "1007486",
//     "1007489",
//     "1007737",
//     "1007806",
//     "1007810",
//     "1007812",
//     "1007901",
//     "1007922",
//     "1008056",
//     "1008117",
//     "1008121",
//     "1008129",
//     "1008169",
//     "1008210",
//     "1008224",
//     "1008258",
//     "1008293",
//     "1008307",
//     "1008328",
//     "1008336",
//     "1008346",
//     "1008350",
//     "1008383",
//     "1008567",
//     "1008582",
//     "1008848",
//     "1008919",
//     "1009014",
//     "1009033",
//     "1009075",
//     "1009144",
//     "1009152",
//     "1009221",
//     "1009277",
//     "1009278",
//     "1009414",
//     "1009427",
//     "1009428",
//     "1009559",
//     "1009655",
//     "1009683",
//     "1009704",
//     "1009720",
//     "1009769",
//     "1009914",
//     "1010015",
//     "1010030",
//     "1010043",
//     "1010094",
//     "1010145",
//     "1010178",
//     "1010324",
//     "1010373",
//     "1010388",
//     "1010395",
//     "1010438",
//     "1010439",
//     "1010445",
//     "1010503",
//     "1010621",
//     "1011506",
//     "1011509",
//     "1011531",
//     "1011537",
//     "1011550",
//     "1011576",
//     "1011585",
//     "1011591",
//     "1011592",
//     "1011605",
//     "1011608",
//     "1011635",
//     "1011640",
//     "1011645",
//     "1011658",
//     "1011675",
//     "1011681",
//     "1011682",
//     "1011698",
//     "1011704",
//     "1011708",
//     "1011723",
//     "1011724",
//     "1011732",
//     "1011736",
//     "1011784",
//     "1011788",
//     "1011821",
//     "1011823",
//     "1011826",
//     "1011862",
//     "1011940",
//     "1011997",
//     "1012016",
//     "1012045",
//     "1012062",
//     "1012085",
//     "1012152",
//     "1012321",
//     "1012329",
//     "1012332",
//     "1012355",
//     "1012370",
//     "1012393",
//     "1012394",
//     "1012422",
//     "1012429",
//     "1012451",
//     "1012513",
//     "1012517",
//     "1012572",
//     "1012577",
//     "1012597",
//     "1012601",
//     "1012633",
//     "1012634",
//     "1012639",
//     "1012640",
//     "1012649",
//     "1012653",
//     "1012658",
//     "1012660",
//     "1012671",
//     "1012680",
//     "1012682",
//     "1012703",
//     "1012704",
//     "1012710",
//     "1012724",
//     "1012757",
//     "1012772",
//     "1012774",
//     "1012777",
//     "1012780",
//     "1012785",
//     "1012787",
//     "1012822",
//     "1012836",
//     "1012877",
//     "1012890",
//     "1012897",
//     "1012938",
//     "1012941",
//     "1012947",
//     "1012970",
//     "1013009",
//     "1013017",
//     "1013025",
//     "1013026",
//     "1013041",
//     "1013050",
//     "1013067",
//     "1013074",
//     "1013113",
//     "1013114",
//     "1013124",
//     "1013125",
//     "1013146",
//     "1013148",
//     "1013154",
//     "1013164",
//     "1013179",
//     "1013235",
//     "1013329",
//     "1013342",
//     "1013375",
//     "1013377",
//     "1013378",
//     "1013385",
//     "1013458",
//     "1013460",
//     "1013532",
//     "1013535",
//     "1013573",
//     "1013583",
//     "1013589",
//     "1013602",
//     "1013629",
//     "1013654",
//     "1013663",
//     "1013705",
//     "1013708",
//     "1013739",
//     "1013746",
//     "1013767",
//     "1013790",
//     "1013811",
//     "1013817",
//     "1013835",
//     "1013841",
//     "1013855",
//     "1013857",
//     "1013894",
//     "1013911",
//     "1013923",
//     "1013924",
//     "1013939",
//     "1013943",
//     "1013949",
//     "1013966",
//     "1013968",
//     "1013973",
//     "1013989",
//     "1014006",
//     "1014008",
//     "1014046",
//     "1014094",
//     "1014119",
//     "1014127",
//     "1014132",
//     "1014145",
//     "1014171",
//     "1014192",
//     "1014232",
//     "1014254",
//     "1014255",
//     "1014275",
//     "1014304",
//     "1014311",
//     "1014321",
//     "1014330",
//     "1014331",
//     "1014349",
//     "1014372",
//     "1014485",
//     "1014500",
//     "1014521",
//     "1014529",
//     "1014561",
//     "1014573",
//     "1014600",
//     "1014644",
//     "1014645",
//     "1014649",
//     "1014696",
//     "1014698",
//     "1014734",
//     "1014797",
//     "1014806",
//     "1014823",
//     "1014831",
//     "1014845",
//     "1014920",
//     "1014930",
//     "1014936",
//     "1014940",
//     "1014955",
//     "1014976",
//     "1014997",
//     "1015000",
//     "1015017",
//     "1015020",
//     "1015030",
//     "1015034",
//     "1015047",
//     "1015058",
//     "1015085",
//     "1015090",
//     "1015134",
//     "1015153",
//     "1015154",
//     "1015176",
//     "1015178",
//     "1015305",
//     "1015360",
//     "1015391",
//     "1015422",
//     "1015445",
//     "1015542",
//     "1015551",
//     "1015558",
//     "1015563",
//     "1015564",
//     "1015603",
//     "1015607",
//     "1015636",
//     "1015644",
//     "1015672",
//     "1015686",
//     "1015734",
//     "1015741",
//     "1015792",
//     "1015801",
//     "1015816",
//     "1015843",
//     "1015866",
//     "1015886",
//     "1015910",
//     "1015928",
//     "1015966",
//     "1016021",
//     "1016035",
//     "1016042",
//     "1016060",
//     "1016103",
//     "1016137",
//     "1016145",
//     "1016150",
//     "1016176",
//     "1016182",
//     "1016195",
//     "1016196",
//     "1016199",
//     "1016207",
//     "1016219",
//     "1016261",
//     "1016265",
//     "1016275",
//     "1016279",
//     "1016282",
//     "1016300",
//     "1016303",
//     "1016308",
//     "1016314",
//     "1016323",
//     "1016335",
//     "1016338",
//     "1016394",
//     "1016416",
//     "1016455",
//     "1016463",
//     "1016505",
//     "1016531",
//     "1016540",
//     "1016548",
//     "1016566",
//     "1016598",
//     "1016644",
//     "1016665",
//     "1016668",
//     "1016670",
//     "1016689",
//     "1016706",
//     "1016757",
//     "1016795",
//     "1016813",
//     "1016852",
//     "1016874",
//     "1016878",
//     "1016938",
//     "1016964",
//     "1017003",
//     "1017015",
//     "1017022",
//     "1017077",
//     "1017080",
//     "1017168",
//     "1017194",
//     "1017199",
//     "1017206",
//     "1017298",
//     "1017324",
//     "1017332",
//     "1017334",
//     "1017366",
//     "1017499",
//     "1017514",
//     "1017567",
//     "1017578",
//     "1017596",
//     "1017649",
//     "1017670",
//     "1017705",
//     "1019066",
//     "1020890",
//     "1024833",
//     "1077001",
//     "1077149",
//     "1078284",
//     "2000402",
//     "2000684",
//     "2000697",
//     "2000736",
//     "2000754",
//     "2001067",
//     "2001146",
//     "2001232",
//     "2001265",
//     "2001398",
//     "2001417",
//     "2001428",
//     "2001445",
//     "2001461",
//     "2001474",
//     "2001485",
//     "2001545",
//     "2001726",
//     "2001760",
//     "2001780",
//     "2001792",
//     "2001801",
//     "2001899",
//     "2001900",
//     "2001906",
//     "2001910",
//     "2001931",
//     "2001991",
//     "2002001",
//     "2002017",
//     "2002043",
//     "2002050",
//     "2002109",
//     "2002110",
//     "2002149",
//     "2002178",
//     "2002188",
//     "2002213",
//     "2002282",
//     "2002295",
//     "2002309",
//     "2002320",
//     "2002392",
//     "2002429",
//     "2002537",
//     "2002545",
//     "2002622",
//     "2002733",
//     "2002779",
//     "2002965",
//     "2003058",
//     "2003099",
//     "2003371",
//     "2003517",
//     "2003529",
//     "2003641",
//     "2003653",
//     "2003724",
//     "2003733",
//     "2004031",
//     "2004053",
//     "2004076",
//     "2004220",
//     "2004397",
//     "2004669",
//     "2004723",
//     "2004729",
//     "2004731",
//     "2004807",
//     "2004942",
//     "2005227",
//     "2005376",
//     "2005455",
//     "2005648",
//     "2005693",
//     "2005904",
//     "2005923",
//     "2005949",
//     "2005996",
//     "2006004",
//     "2006027",
//     "2006090",
//     "2006202",
//     "2006203",
//     "2006232",
//     "2006243",
//     "2006244",
//     "2006370",
//     "2006393",
//     "2006413",
//     "2006442",
//     "2006544",
//     "2006639",
//     "2006816",
//     "2006876",
//     "2006885",
//     "2006922",
//     "2006923",
//     "2006951",
//     "2007127",
//     "2007231",
//     "2007241",
//     "2007254",
//     "2007309",
//     "2007356",
//     "2007360",
//     "2007401",
//     "2007448",
//     "2007493",
//     "2007683",
//     "2007833",
//     "2007913",
//     "2007980",
//     "2008128",
//     "2008181",
//     "2008215",
//     "2008238",
//     "2008338",
//     "2008359",
//     "2008365",
//     "2008382",
//     "2008573",
//     "2008588",
//     "2008632",
//     "2008636",
//     "2008656",
//     "2008720",
//     "2008728",
//     "2008739",
//     "2008758",
//     "2008815",
//     "2008841",
//     "2008872",
//     "2008916",
//     "2009013",
//     "2009185",
//     "2009194",
//     "2009284",
//     "2009302",
//     "2009307",
//     "2009372",
//     "2009401",
//     "2009446",
//     "2009459",
//     "2009571",
//     "2009575",
//     "2009642",
//     "2009644",
//     "2009675",
//     "2009695",
//     "2009728",
//     "2009742",
//     "2009941",
//     "2009953",
//     "2009984",
//     "2010065",
//     "2010126",
//     "2010133",
//     "2010161",
//     "2010188",
//     "2010189",
//     "2010208",
//     "2010217",
//     "2010218",
//     "2010221",
//     "2010224",
//     "2010242",
//     "2010245",
//     "2010253",
//     "2010254",
//     "2010257",
//     "2010264",
//     "2010269",
//     "2010278",
//     "2010289",
//     "2010296",
//     "2010300",
//     "2010318",
//     "2010321",
//     "2010348",
//     "2010381",
//     "2010385",
//     "2010399",
//     "2010437",
//     "2010448",
//     "2010466",
//     "2010473",
//     "2010474",
//     "2010479",
//     "2010557",
//     "2010570",
//     "2010571",
//     "2010585",
//     "2010600",
//     "2010602",
//     "2010606",
//     "2010687",
//     "2010707",
//     "2010789",
//     "2010828",
//     "2010853",
//     "2010870",
//     "2010876",
//     "2010877",
//     "2010910",
//     "2010975",
//     "2011080",
//     "2011081",
//     "2011109",
//     "2011116",
//     "2011158",
//     "2011233",
//     "2011245",
//     "2011269",
//     "2011545",
//     "2011870",
//     "2011941",
//     "2012206",
//     "2012418",
//     "2012431",
//     "2012440",
//     "2012451",
//     "2012465",
//     "2012551",
//     "2012566",
//     "2012605",
//     "2012665",
//     "2012684",
//     "2012685",
//     "2012753",
//     "2012754",
//     "2014959",
//     "2015031",
//     "2015119",
//     "2015137",
//     "2015401",
//     "2015437",
//     "2015577",
//     "2015767",
//     "2015975",
//     "2016360",
//     "2016508",
//     "2016538",
//     "2016765",
//     "2017028",
//     "2017270",
//     "2017761",
//     "2017785",
//     "2017932",
//     "2018081",
//     "2018405",
//     "2018686",
//     "2018715",
//     "2018849",
//     "2018912",
//     "2018921",
//     "2019037",
//     "2019040",
//     "2019279",
//     "2020457",
//     "2020493",
//     "2021828",
//     "2021955",
//     "2021962",
//     "2021982",
//     "2022901",
//     "2023610",
//     "2023705",
//     "2023729",
//     "2024179",
//     "2024542",
//     "2025649",
//     "2026725",
//     "2028066",
//     "2028450",
//     "2028555",
//     "2030867",
//     "2031817",
//     "2035153",
//     "2035198",
//     "2035805",
//     "2036556",
//     "2070382",
//     "2071503",
//     "2089196",
//     "2097013",
//     "2106699",
//     "2107926"
//   ];
const customersToDelete = [
    "1100002",
    "1100003",
    "1100004",
    "1100005",
    "1100006",
    "1100007",
    "1100008",
    "1100009"
  ];
deleteCustomerVectors(customersToDelete);

export { deleteCustomerVectors };
